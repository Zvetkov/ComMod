# Используем диффер

Отметим, что в большинстве случаев нет никакой необходимости вручную писать команды.

Наиболее простой процесс разработки merge-мода предполагает наличие дву копий игры:
* базовой копии, чистой игры, или с установленным КомРемом или другим крупным базовым модом, который вы выбрали за основу
* модифицированной копии игры, содержащей ваши изменения относительно базовой копии

Автоматический диффер ComMod'а затем может быть использован, чтобы найти разницу между отдельными файлами этих копий и сгенерировать список команд.

ComMod позволяет при установке мода патчить (объединять) сразу несколько файлов.

Типичным пример такого использования будет работа с `servers.xml`.

Большинство новых объектов необходимо прописать в servers каждой из карт. Но так же есть объекты которые могут быть специфичны только для одной карты, например крупные декорации карты. Третий случай - это кабины и кузова автомобилей, для которых записи в servers двух карт одного региона могут быть одинаковы, а вот между разными регионами записи будут отличаться, из-за разного списка скинов\раскрасок, доступных в этом регионе.

В таком случае мы можем сгенерировать три отдельных файла команд:
* объекты общие для всех карт (назовём его `_servers_all_regions.xml`)
* объекты общие для отдельных регионов (`_servers_r1.xml`, `_servers_r2.xml` и т.д.)
* уникальные объекты, которые будут применяться только к servers одной карты (`_servers_r1m1.xml`)

Наша yaml инструкция, объясняющая ComMod как объединять файлы тогда выглядела бы так:
```yaml
- commands: data/maps/_servers_all_regions.xml
  targets:
    - maps/r1m1/servers.xml
    - maps/r1m2/servers.xml
    - maps/r1m3/servers.xml
    - maps/r1m4/servers.xml
    - maps/r2m1/servers.xml
    - maps/r2m2/servers.xml
    - maps/r3m1/servers.xml
    - maps/r3m2/servers.xml
    - maps/r4m1/servers.xml
    - maps/r4m2/servers.xml

- commands: data/maps/_servers_r1.xml
  targets:
    - maps/r1m1/servers.xml
    - maps/r1m2/servers.xml
    - maps/r1m3/servers.xml
    - maps/r1m4/servers.xml

- commands: data/maps/_servers_r2.xml
  targets:
    - maps/r2m1/servers.xml
    - maps/r2m2/servers.xml

- commands: data/maps/_servers_r1m1.xml
  targets:
    - maps/r1m1/servers.xml
```

Теперь когда мы захотим добавить что-то в servers всех карт - нам надо будет обновить один файл в моде.

Аналогично если у нашего мода есть несколько вариантов установки, например поверх ComRem и поверх ISL, мы можем команды общие для обоих модов вынести в один файл, а уникальные для каждого из вариантов команды, записать в отдельные файлы.

Чтобы сгенерировать несколько файлов, мы можем воспользоваться функцией "Сохранить выбранные" диффера.
В обозначенном выше случае мы сперва "выберем все" команды, потом вручную пройдёмся и снимем выделение со всего что не должно применяться ко всем картам. Это будет наш `_servers_all_regions.xml`.

Сохранив этот файл, мы подключем его уже в наш диффер, чтобы эти команды пропали из списка.

Для этого используем функцию "Подгрузите сушествующие команды".

Теперь отберём только команды специфичные для region1 и так далее.
